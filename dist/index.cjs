"use strict";var lt=Object.defineProperty;var nt=i=>{throw TypeError(i)};var wt=(i,t,e)=>t in i?lt(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var h=(i,t,e)=>wt(i,typeof t!="symbol"?t+"":t,e),rt=(i,t,e)=>t.has(i)||nt("Cannot "+e);var u=(i,t,e)=>(rt(i,t,"read from private field"),e?e.call(i):t.get(i)),w=(i,t,e)=>t.has(i)?nt("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),p=(i,t,e,s)=>(rt(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e);Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const ft=require("@bitcoinerlab/secp256k1"),E=require("bitcoinjs-lib"),r=require("./index-Dfqe4I64.cjs"),gt=require("./BrowserWalletNetworkMismatchError-CDpdIBHK.cjs"),ut=require("./BrowserWalletSigningError-CXaOQVy_.cjs"),ot=require("cross-fetch"),mt=require("buffer-reverse");function St(i){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(i){for(const e in i)if(e!=="default"){const s=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,s.get?s:{enumerable:!0,get:()=>i[e]})}}return t.default=i,Object.freeze(t)}const It=St(ft);class ht{constructor({chain:t="bitcoin",network:e}){h(this,"chain");h(this,"network");this.chain=t,this.network=e}}class z{static parseInscription(t,{decodeMetadata:e}){return{...t,meta:e&&t.meta?r.UNSTABLE_decodeObject(t.meta):t.meta}}static parseInscriptions(t,{decodeMetadata:e}){return t.map(s=>this.parseInscription(s,{decodeMetadata:e}))}static segregateUTXOsBySpendStatus({utxos:t}){const{spendableUTXOs:e,unspendableUTXOs:s}=t.reduce((n,o)=>(o.safeToSpend?n.spendableUTXOs.push(o):n.unspendableUTXOs.push(o),n),{spendableUTXOs:[],unspendableUTXOs:[]});return{totalUTXOs:t.length,spendableUTXOs:e,unspendableUTXOs:s}}}const b={version:"0.0.0.10",apis:{bitcoin:{mainnet:"https://mainnet.ordit.io/",regtest:"https://regtest.ordit.io/",testnet:"https://testnet.ordit.io/",signet:"https://signet.ordit.io/"},"fractal-bitcoin":{mainnet:"https://fractal.ordit.io/",regtest:"https://fractal-regtest.ordit.io/",testnet:"https://fractal-testnet.ordit.io/",signet:"https://fractal-signet.ordit.io/"}}};function bt(i){return typeof i=="number"&&i>Number.NEGATIVE_INFINITY&&i<Number.POSITIVE_INFINITY}function Tt(i){return bt(i)&&i%1===0}function yt(i){return typeof i=="string"}function At(i){return yt(i)||Tt(i)||i===null}function T(i){return i[i.length-1]==="/"?i.substring(0,i.length-1):i}class y{constructor(t){this.url=t}async notify(t,e){await ot(`${this.url}/rpc`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:t,params:e})})}async call(t,e,s){let n={},o=s;At(e)?o=e:n=e;const c=await ot(`${this.url}/rpc`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({jsonrpc:"2.0",method:t,params:n,id:o})});if(c.status===200){const d=await c.json();if(d.error){const l=typeof d.error.data=="string"?d.error.data:d.error.message;throw new r.OrditSDKError(l)}return d.result}throw new r.OrditSDKError("Internal Server Error")}}const f={get id(){return Math.floor(Math.random()*1e5)},bitcoin:{mainnet:new y(T(b.apis.bitcoin.mainnet)),testnet:new y(T(b.apis.bitcoin.testnet)),signet:new y(T(b.apis.bitcoin.signet)),regtest:new y(T(b.apis.bitcoin.regtest))},"fractal-bitcoin":{mainnet:new y(T(b.apis["fractal-bitcoin"].mainnet)),testnet:new y(T(b.apis["fractal-bitcoin"].testnet)),signet:new y(T(b.apis["fractal-bitcoin"].testnet)),regtest:new y(T(b.apis["fractal-bitcoin"].testnet))}};class et extends ht{constructor({chain:t="bitcoin",network:e}){super({chain:t,network:e})}async getBalance({address:t}){if(!t)throw new r.OrditSDKError("Invalid request");return f[this.chain][this.network].call("Address.GetBalance",{address:t},f.id)}async getInscription({id:t,decodeMetadata:e=!1}){if(!t)throw new r.OrditSDKError("Invalid request");const s=r.outpointToIdFormat(t),n=await f[this.chain][this.network].call("Ordinals.GetInscription",{id:s},f.id);return z.parseInscription(n,{decodeMetadata:e})}async getInscriptionUTXO({id:t}){if(!t)throw new r.OrditSDKError("Invalid request");const e=r.outpointToIdFormat(t);return f[this.chain][this.network].call("Ordinals.GetInscriptionUtxo",{id:e},f.id)}async getInscriptions({creator:t,owner:e,mimeType:s,mimeSubType:n,outpoint:o,decodeMetadata:c=!1,sort:d="asc",limit:l=25,next:m=null}){let g=[],S=m;do{const{inscriptions:L,pagination:tt}=await f[this.chain][this.network].call("Ordinals.GetInscriptions",{filter:{creator:t,owner:e,mimeType:s,mimeSubType:n,outpoint:o},sort:{number:d},pagination:{limit:l,next:S}},f.id);g=g.concat(L),S=tt.next}while(S!==null);return z.parseInscriptions(g,{decodeMetadata:c})}async getSpendables({address:t,value:e,rarity:s=["common"],filter:n=[],limit:o=200,type:c="spendable"}){if(!t||Number.isNaN(e)||!e)throw new r.OrditSDKError("Invalid request");return f[this.chain][this.network].call("Address.GetSpendables",{address:t,value:e,safetospend:c==="spendable",allowedrarity:s,filter:n,limit:o},f.id)}async getTransaction({txId:t,ordinals:e=!0,hex:s=!1,witness:n=!0,decodeMetadata:o=!0}){if(!t)throw new r.OrditSDKError("Invalid request");const c=await f[this.chain][this.network].call("Transactions.GetTransaction",{txid:t,options:{ord:e,hex:s,witness:n}},f.id);return c.vout=c.vout.map(d=>({...d,inscriptions:z.parseInscriptions(d.inscriptions,{decodeMetadata:o})})),{tx:c,rawTx:s&&c.hex?E.Transaction.fromHex(c.hex):void 0}}async getUnspents({address:t,type:e="spendable",rarity:s=["common"],sort:n="desc",limit:o=50,next:c=null}){if(!t)throw new r.OrditSDKError("Invalid request");let d=[],l=c;do{const{unspents:m,pagination:g}=await f[this.chain][this.network].call("Address.GetUnspents",{address:t,options:{allowedrarity:s,safetospend:e==="spendable"},pagination:{limit:o,next:l},sort:{value:n}},f.id);d=d.concat(m),l=g.next}while(l!==null);return z.segregateUTXOsBySpendStatus({utxos:d})}async relay({hex:t,maxFeeRate:e,validate:s=!0}){if(!t)throw new r.OrditSDKError("Invalid request");if(e&&(e<0||Number.isNaN(e)))throw new r.OrditSDKError("Invalid max fee rate");return f[this.chain][this.network].call("Transactions.Relay",{hex:t,maxFeeRate:e,validate:s},f.id)}}const ct=1e8,V=21e4,Z=2016,st=6,x=209999999769e4,dt=x-1;class Q{constructor(t,e){this.height=t,this.offset=e}static from(t){return new Q(t.height,t.third)}toString(){return`${this.height.n}.${this.offset}`}}class pt{constructor(t){h(this,"hour");h(this,"minute");h(this,"second");h(this,"third");const e=t.height.n;this.hour=Math.floor(e/(st*V)),this.minute=Math.floor(e%V),this.second=Math.floor(e%Z),this.third=t.third}toString(){return`${this.hour}°${this.minute}′${this.second}″${this.third}‴`}}var A=(i=>(i.Common="common",i.Uncommon="uncommon",i.Rare="rare",i.Epic="epic",i.Legendary="legendary",i.Mythic="mythic",i.Palindrome="palindrome",i))(A||{});class W{constructor(t){this.sattributes=t}static from(t){const e=[];return W.isPalindrome(t.n)&&e.push("palindrome"),new W([t.rarity.name,...e])}static isPalindrome(t){const e=t.toString(),s=e.split("").reverse().join("");return e===s}toString(){return this.sattributes.toString()}toList(){return this.sattributes}}class I{constructor(t){this.name=t}static from(t){const{hour:e,minute:s,second:n,third:o}=t.degree;return e===0&&s===0&&n===0&&o===0?new I(A.Mythic):s===0&&n===0&&o===0?new I(A.Legendary):s===0&&o===0?new I(A.Epic):n===0&&o===0?new I(A.Rare):o===0?new I(A.Uncommon):new I(A.Common)}toString(){return this.name}}var U,N,P,B,M,D,j,_,k,R,K,X;const it=class it{constructor(t){w(this,U);w(this,N);w(this,P);w(this,B);w(this,M);w(this,D);w(this,j);w(this,_);w(this,k);w(this,R);w(this,K);w(this,X);if(this.n=t,t>x||t<0)throw new Error("sat out of range")}static fromName(t){let e=0;for(let s=0;s<t.length;s+=1){const n=t[s];if(n>="a"&&n<="z")e=e*26+n.charCodeAt(0)-97+1;else throw new Error(`invalid character in sat name: ${n}`)}if(e>x)throw new Error("sat name out of range");return new it(x-e)}get height(){return u(this,U)===void 0&&p(this,U,new Y(Math.floor(this.epoch.startingHeight.n+this.epochPosition/this.epoch.subsidy))),u(this,U)}get cycle(){return u(this,N)===void 0&&p(this,N,Math.floor(this.epoch.n/st)),u(this,N)}get percentile(){return u(this,P)===void 0&&p(this,P,`${this.n/dt*100}%`),u(this,P)}get degree(){return u(this,B)===void 0&&p(this,B,new pt(this)),u(this,B)}get third(){return u(this,M)===void 0&&p(this,M,Math.floor(this.epochPosition%this.epoch.subsidy)),u(this,M)}get epoch(){return u(this,D)===void 0&&p(this,D,$.from(this)),u(this,D)}get period(){return u(this,j)===void 0&&p(this,j,Math.floor(this.height.n/Z)),u(this,j)}get rarity(){return u(this,_)===void 0&&p(this,_,I.from(this)),u(this,_)}get epochPosition(){return u(this,k)===void 0&&p(this,k,Math.floor(this.n-this.epoch.startingSat.n)),u(this,k)}get decimal(){return u(this,R)===void 0&&p(this,R,Q.from(this)),u(this,R)}get name(){if(u(this,K)===void 0){let t=x-this.n,e="";for(;t>0;)e+="abcdefghijklmnopqrstuvwxyz".charAt((t-1)%26),t=Math.floor((t-1)/26);p(this,K,e.split("").reverse().join(""))}return u(this,K)}get sattributes(){return u(this,X)===void 0&&p(this,X,W.from(this)),u(this,X)}toJSON(){return{number:this.n,decimal:this.decimal.toString(),degree:this.degree.toString(),name:this.name,block:this.height.n,cycle:this.cycle,epoch:this.epoch.n,period:this.period,offset:this.third,rarity:this.rarity.toString(),percentile:this.percentile,sattributes:this.sattributes.toList()}}};U=new WeakMap,N=new WeakMap,P=new WeakMap,B=new WeakMap,M=new WeakMap,D=new WeakMap,j=new WeakMap,_=new WeakMap,k=new WeakMap,R=new WeakMap,K=new WeakMap,X=new WeakMap;let a=it;const G=[new a(0),new a(105e13),new a(1575e12),new a(18375e11),new a(196875e10),new a(2034375e9),new a(20671875e8),new a(208359375e7),new a(2091796875e6),new a(20958984375e5),new a(209794921875e4),new a(209897460927e4),new a(209948730453e4),new a(209974365216e4),new a(209987182587e4),new a(209993591262e4),new a(209996795589e4),new a(209998397742e4),new a(209999198808e4),new a(209999599341e4),new a(209999799597e4),new a(209999899725e4),new a(209999949789e4),new a(209999974821e4),new a(209999987337e4),new a(209999993595e4),new a(209999996724e4),new a(209999998278e4),new a(209999999055e4),new a(209999999433e4),new a(209999999622e4),new a(209999999706e4),new a(209999999748e4),new a(x)];var C,q;const J=class J{constructor(t){w(this,C);w(this,q);this.n=t}get startingSat(){if(u(this,C)===void 0){const t=$.fromHeight(this),{startingSat:e}=t,{startingHeight:s}=t;p(this,C,new a(e.n+(this.n-s.n)*t.subsidy))}return u(this,C)}get periodOffset(){return u(this,q)===void 0&&p(this,q,Math.floor(this.n%Z)),u(this,q)}add(t){return new J(this.n+t)}sub(t){return new J(this.n-t)}eq(t){return this.n===t}};C=new WeakMap,q=new WeakMap;let Y=J;var v,F,H;const O=class O{constructor(t){w(this,v);w(this,F);w(this,H);this.n=t}static from(t){let e=1;for(;e<=33;){if(t.n<G[e].n)return new O(e-1);e+=1}return new O(33)}static fromHeight(t){return new O(Math.floor(t.n/V))}get subsidy(){return u(this,v)===void 0&&(this.n<O.FIRST_POST_SUBSIDY.n?p(this,v,Math.floor(50*ct/2**this.n)):p(this,v,0)),u(this,v)}get startingSat(){return u(this,F)===void 0&&p(this,F,G[this.n]||G[G.length-1]),u(this,F)}get startingHeight(){return u(this,H)===void 0&&p(this,H,new Y(this.n*V)),u(this,H)}};v=new WeakMap,F=new WeakMap,H=new WeakMap,h(O,"FIRST_POST_SUBSIDY",new O(33));let $=O;const Ot=10.5;function at(i){switch(i){case"taproot":return{input:42,output:43,witness:66};case"segwit":return{input:41,output:31,witness:105};case"p2sh-p2wpkh":return{input:64,output:32,witness:105};case"legacy":return{input:148,output:34,witness:0};default:throw new r.OrditSDKError("Invalid type")}}class Et{constructor({feeRate:t,chain:e="bitcoin",network:s,psbt:n,witness:o}){h(this,"fee",0);h(this,"feeRate");h(this,"chain");h(this,"network");h(this,"psbt");h(this,"witness",[]);h(this,"virtualSize",0);h(this,"weight",0);if(t<0||!Number.isSafeInteger(t))throw new r.OrditSDKError("Invalid feeRate");this.feeRate=t,this.chain=e,this.network=s,this.witness=o||[],this.psbt=n||new E.Psbt({network:r.getNetwork(e==="fractal-bitcoin"?"mainnet":this.network)})}get data(){return{fee:this.fee,virtualSize:this.virtualSize,weight:this.weight}}calculateNetworkFee(){if(this.fee=this.calculateVirtualSize()*this.feeRate,this.fee>r.MAXIMUM_FEE)throw new r.OrditSDKError("Error while calculating fees");return this.fee}getInputAndOutputScriptTypes(){const{inputs:t}=this.psbt.data,e=this.psbt.txOutputs;if(t.length===0)throw new r.OrditSDKError("PSBT must have at least one input");if(e.length===0)throw new r.OrditSDKError("PSBT must have at least one output");return{inputTypes:t.map(s=>{const n=s.witnessUtxo&&s.witnessUtxo.script?s.witnessUtxo.script:null;if(!n)throw new r.OrditSDKError("Invalid script");return r.getScriptType(n,this.network).format}),outputTypes:e.map(s=>r.getScriptType(s.script,this.network).format)}}calculateScriptWitnessSize(){var e;const{inputTypes:t}=this.getInputAndOutputScriptTypes();return t.includes("taproot")&&((e=this.witness)!=null&&e.length)?this.witness.reduce((s,n)=>s+n.byteLength,0):0}getBaseSize(){var l,m;const{inputTypes:t,outputTypes:e}=this.getInputAndOutputScriptTypes(),s=2,n=t.reduce((g,S)=>{const{input:L,witness:tt}=at(S);return g.input+=L,g.witness+=tt,g},{input:0,witness:0}),o=e.reduce((g,S)=>{const{output:L}=at(S);return g+L},0),c=n.witness+((l=this.witness)!=null&&l.length?this.calculateScriptWitnessSize():0);let d=0;return(m=this.witness)!=null&&m.length?d=c:c>0&&(d=s+c),{baseSize:n.input+Ot+o,witnessSize:d}}calculateVirtualSize(){const{baseSize:t,witnessSize:e}=this.getBaseSize();return this.weight=t*3+(t+e),this.virtualSize=Math.ceil(this.weight/4),this.virtualSize}}function xt({utxo:i,pubKey:t,network:e,sighashType:s,witness:n}){const o=r.BIP32.fromPublicKey(r.Buffer.from(t,"hex"),r.CHAIN_CODE,r.getNetwork(e)),c=r.toXOnly(o.publicKey);if(!i.scriptPubKey.hex)throw new Error("Unable to process p2tr input");return{type:"taproot",hash:i.txid,index:i.n,tapInternalKey:c,witnessUtxo:{script:r.Buffer.from(i.scriptPubKey.hex,"hex"),value:i.sats},witness:n,...s?{sighashType:s}:void 0}}function vt({utxo:i,sighashType:t}){if(!i.scriptPubKey.hex)throw new Error("Unable to process Segwit input");return{type:"segwit",hash:i.txid,index:i.n,witnessUtxo:{script:r.Buffer.from(i.scriptPubKey.hex,"hex"),value:i.sats},...t?{sighashType:t}:void 0}}function Ut({utxo:i,pubKey:t,network:e,sighashType:s}){const n=r.createPayment(r.Buffer.from(t,"hex"),"p2sh",e);if(!n||!n.output||!n.redeem)throw new Error("Unable to process P2SH input");return{type:"p2sh-p2wpkh",hash:i.txid,index:i.n,redeemScript:n.redeem.output,witnessUtxo:{script:r.Buffer.from(i.scriptPubKey.hex,"hex"),value:i.sats},...s?{sighashType:s}:void 0}}async function Nt({utxo:i,sighashType:t,network:e,pubKey:s,datasource:n}){const{rawTx:o}=await n.getTransaction({txId:i.txid,hex:!0});if(!o)throw new Error("Unable to process legacy input");const c=r.createPayment(r.Buffer.from(s,"hex"),"p2pkh",e);return{type:"legacy",hash:i.txid,index:i.n,nonWitnessUtxo:o==null?void 0:o.toBuffer(),witnessUtxo:{script:c.output,value:i.sats},...t?{sighashType:t}:void 0}}async function Pt({utxo:i,pubKey:t,network:e,sighashType:s,witness:n,datasource:o}){const c=o||new et({network:e});switch(i.scriptPubKey.type){case"witness_v1_taproot":return xt({utxo:i,pubKey:t,network:e,sighashType:s,witness:n});case"witness_v0_scripthash":case"witness_v0_keyhash":return vt({utxo:i,sighashType:s});case"scripthash":return Ut({utxo:i,pubKey:t,network:e,sighashType:s});case"pubkeyhash":return Nt({utxo:i,sighashType:s,network:e,pubKey:t,datasource:c});default:throw new Error("invalid script pub type")}}class Bt extends Et{constructor({address:e,changeAddress:s,datasource:n,feeRate:o,chain:c="bitcoin",network:d="mainnet",publicKey:l,outputs:m,autoAdjustment:g=!0,instantTradeMode:S=!1}){super({feeRate:o,chain:c,network:d});h(this,"address");h(this,"changeAddress");h(this,"changeAmount",0);h(this,"datasource");h(this,"injectableInputs",[]);h(this,"injectableOutputs",[]);h(this,"inputAmount",0);h(this,"inputs",[]);h(this,"outputAmount",0);h(this,"outputs",[]);h(this,"psbt");h(this,"publicKey");h(this,"rbf",!0);h(this,"utxos",[]);h(this,"usedUTXOs",[]);h(this,"autoAdjustment");h(this,"instantTradeMode");h(this,"noMoreUTXOS",!1);this.address=e,this.changeAddress=s,this.datasource=n||new et({chain:this.chain,network:this.network}),this.outputs=m,this.publicKey=l,this.autoAdjustment=g,this.instantTradeMode=S,this.psbt=new E.Psbt({network:r.getNetwork(c==="fractal-bitcoin"?"mainnet":d)})}get data(){return{fee:this.fee,virtualSize:this.virtualSize,weight:this.weight,changeAmount:this.changeAmount,inputAmount:this.inputAmount,outputAmount:this.outputAmount}}toPSBT(){return this.psbt}toHex(){return this.psbt.toHex()}toBase64(){return this.psbt.toBase64()}setRBF(e){this.rbf=e,this.addInputs()}get xKey(){return r.toXOnly(r.Buffer.from(this.publicKey,"hex")).toString("hex")}get inputsToSign(){const e=this.instantTradeMode&&!this.autoAdjustment;return this.psbt.txInputs.reduce((s,n,o)=>((!this.instantTradeMode||this.instantTradeMode&&o!==r.INSTANT_BUY_SELLER_INPUT_INDEX)&&(s.signingIndexes=s.signingIndexes.concat(o)),e&&(s.sigHash=E.Transaction.SIGHASH_SINGLE|E.Transaction.SIGHASH_ANYONECANPAY),s),{address:this.address,signingIndexes:[]})}initPSBT(){this.psbt=new E.Psbt({network:r.getNetwork(this.chain==="fractal-bitcoin"?"mainnet":this.network)}),this.psbt.setMaximumFeeRate(this.feeRate)}getInputSequence(){return this.rbf?4294967293:4294967295}injectInput(e){this.psbt.data.globalMap.unsignedTx.tx.ins[e.injectionIndex]=e.txInput,this.psbt.data.inputs[e.injectionIndex]=e.standardInput}injectOutput(e){let s=e.injectionIndex;do{if(!!!this.psbt.data.globalMap.unsignedTx.tx.outs[s]){this.psbt.data.globalMap.unsignedTx.tx.outs[s]=e.txOutput,this.psbt.data.outputs[s]=e.standardOutput;break}s+=1}while(s)}addInputs(){const e=this.injectableInputs.map(n=>n.injectionIndex),s=[];this.inputs.forEach((n,o)=>{const c=e.includes(o);if(c){const l=this.injectableInputs.find(m=>m.injectionIndex===o);this.injectInput(l),s.push(l.injectionIndex)}this.psbt.txInputs.map(l=>{const m=mt(l.hash);return r.generateTxUniqueIdentifier(m.toString("hex"),l.index)}).includes(r.generateTxUniqueIdentifier(n.hash,n.index))||(this.psbt.addInput(n),this.psbt.setInputSequence(c?o+1:o,this.getInputSequence()))}),this.injectableInputs.forEach(n=>{s.includes(n.injectionIndex)||(this.injectInput(n),s.push(n.injectionIndex))})}addOutputs(){const e=this.injectableOutputs.map(n=>n.injectionIndex),s=[];this.outputs.forEach((n,o)=>{if(e.includes(o)){const c=this.injectableOutputs.find(d=>d.injectionIndex===o);this.injectOutput(c),s.push(c.injectionIndex)}this.psbt.addOutput({address:n.address,value:n.value})}),this.injectableOutputs.forEach(n=>{s.includes(n.injectionIndex)||(this.injectOutput(n),s.push(n.injectionIndex))}),this.changeAmount>=r.MINIMUM_AMOUNT_IN_SATS&&this.psbt.addOutput({address:this.changeAddress||this.address,value:this.changeAmount})}calculateOutputAmount(){if(this.outputAmount=Math.floor(this.outputs.reduce((e,s)=>e+s.value,0)+this.injectableOutputs.reduce((e,s)=>e+s.sats,0)),this.outputAmount<r.MINIMUM_AMOUNT_IN_SATS)throw new Error(`Output amount too low. Minimum output amount needs to be ${r.MINIMUM_AMOUNT_IN_SATS} sats`)}async recursivelyCalculateChangeAmount(){if(this.autoAdjustment&&(this.changeAmount=Math.floor(this.inputAmount-this.outputAmount-this.fee),this.changeAmount<0&&(await this.prepare(),this.noMoreUTXOS)))throw new Error(`Insufficient balance. Decrease the output amount by ${this.changeAmount*-1} sats`)}getRetrievedUTXOsValue(){return this.utxos.reduce((e,s)=>e+s.sats,0)}getReservedUTXOs(){return this.utxos.map(e=>r.generateTxUniqueIdentifier(e.txid,e.n))}getUTXOAmountToRequestFromChangeAmount(){return this.changeAmount<0?Math.abs(this.changeAmount):this.outputAmount-this.getRetrievedUTXOsValue()}async retrieveUTXOs(e,s){if(!this.autoAdjustment&&!e)return;const n=s&&s>0?s:this.getUTXOAmountToRequestFromChangeAmount();if(s&&this.getRetrievedUTXOsValue()>=s||n<=0)return;const o=await this.datasource.getSpendables({address:e||this.address,value:r.convertSatoshisToBTC(n),filter:this.getReservedUTXOs()});this.noMoreUTXOS=o.length===0,this.utxos.push(...o)}async retrieveSelectedUTXOs(e,s){await this.retrieveUTXOs(e,s);const n=this.utxos.find(o=>o.sats>=s);return this.utxos=n?[n]:[],this.utxos}async prepareInputs(){if(!this.autoAdjustment)return;const e=[];this.utxos.forEach(n=>{if(this.usedUTXOs.includes(r.generateTxUniqueIdentifier(n.txid,n.n)))return;this.inputAmount+=n.sats;const o=Pt({utxo:n,pubKey:this.publicKey,network:this.network,datasource:this.datasource});e.push(o)});const s=await Promise.all(e);this.inputAmount+=this.injectableInputs.reduce((n,o)=>n+o.sats,0),s.forEach(n=>{const o=r.generateTxUniqueIdentifier(n.hash,n.index);this.usedUTXOs.includes(o)||this.usedUTXOs.push(o)}),this.inputs=this.inputs.concat(s)}async prepare(){this.calculateOutputAmount(),await this.retrieveUTXOs(),await this.prepareInputs(),await this.recursivelyCalculateChangeAmount(),this.process(),await this.recursivelyCalculateChangeAmount(),this.calculateOutputAmount(),this.process()}process(){return this.initPSBT(),this.addInputs(),this.addOutputs(),this.calculateNetworkFee(),this}}E.initEccLib(It);exports.ADDRESS_FORMAT_TO_TYPE=r.ADDRESS_FORMAT_TO_TYPE;exports.ADDRESS_TYPE_TO_FORMAT=r.ADDRESS_TYPE_TO_FORMAT;exports.BrowserWalletExtractTxFromNonFinalizedPsbtError=r.BrowserWalletExtractTxFromNonFinalizedPsbtError;exports.BrowserWalletNotInstalledError=r.BrowserWalletNotInstalledError;exports.OrditSDKError=r.OrditSDKError;exports.getAddressFormat=r.getAddressFormat;exports.getAddressType=r.getAddressType;exports.getAddressesFromPublicKey=r.getAddressesFromPublicKey;exports.getNetworkByAddress=r.getNetworkByAddress;exports.validateAddress=r.validateAddress;exports.BrowserWalletNetworkMismatchError=gt.BrowserWalletNetworkMismatchError;exports.BrowserWalletRequestCancelledByUserError=ut.BrowserWalletRequestCancelledByUserError;exports.BrowserWalletSigningError=ut.BrowserWalletSigningError;exports.BaseDatasource=ht;exports.COIN_VALUE=ct;exports.CYCLE_EPOCHS=st;exports.DIFFCHANGE_INTERVAL=Z;exports.DatasourceUtility=z;exports.Decimal=Q;exports.Degree=pt;exports.Epoch=$;exports.Height=Y;exports.JsonRpcDatasource=et;exports.LAST_SAT=dt;exports.PSBTBuilder=Bt;exports.Rarity=I;exports.SAT_SUPPLY=x;exports.STARTING_SATS=G;exports.SUBSIDY_HALVING_INTERVAL=V;exports.Sat=a;exports.Sattribute=A;exports.Sattributes=W;

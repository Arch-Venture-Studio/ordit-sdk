"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});const e=require("./index-Dfqe4I64.cjs"),P=require("bitcoinjs-lib");require("./index.cjs");const b=require("./BrowserWalletSigningError-CXaOQVy_.cjs"),y=require("./BrowserWalletNetworkMismatchError-CDpdIBHK.cjs");var N=(r=>(r[r.ALL=1]="ALL",r[r.NONE=2]="NONE",r[r.SINGLE=3]="SINGLE",r[r.ALL_ANYONECANPAY=129]="ALL_ANYONECANPAY",r[r.NONE_ANYONECANPAY=130]="NONE_ANYONECANPAY",r[r.SINGLE_ANYONECANPAY=131]="SINGLE_ANYONECANPAY",r))(N||{}),l=(r=>(r.P2WPKH="p2wpkh",r.P2TR="p2tr",r))(l||{});async function d(r,n){try{return(await window.LeatherProvider.request(r,n)).result}catch(o){const s=o,{message:t}=s.error;throw s.error.code===4001?new b.BrowserWalletRequestCancelledByUserError(t):new e.OrditSDKError(`Leather error: ${t}`)}}function c(){if(typeof window>"u")throw new e.OrditSDKError("Cannot call this function outside a browser");return typeof window.LeatherProvider<"u"}async function m(r="mainnet"){if(!c())throw new e.BrowserWalletNotInstalledError("Leather not installed");const o=(await d("getAddresses",{network:r})).addresses.filter(t=>t.type===l.P2TR||t.type===l.P2WPKH),s=e.getNetworkByAddress(o[0].address);if(r!=="signet"&&s!==r||r==="signet"&&s!=="testnet")throw new y.BrowserWalletNetworkMismatchError("Leather network mismatch, please switch it manually");return o.map(t=>({publicKey:t.publicKey,address:t.address,format:e.ADDRESS_TYPE_TO_FORMAT[t.type]}))}async function p(r,{network:n="mainnet",paymentType:o}){if(!c())throw new e.BrowserWalletNotInstalledError("Leather not installed");const{signature:s}=await d("signMessage",{message:r,paymentType:o,network:n});return{base64:s,hex:e.Buffer.from(s,"base64").toString("hex")}}async function O(r,{finalize:n=!0,extractTx:o=!0,allowedSighash:s,accountNumber:t,network:E="mainnet",signAtIndexes:w=[]}={}){if(!c())throw new e.BrowserWalletNotInstalledError("Leather not installed");if(o&&!n)throw new e.BrowserWalletExtractTxFromNonFinalizedPsbtError;const f=r.toHex(),u=await d("signPsbt",{hex:f,allowedSighash:s,account:t,network:E,signAtIndex:w,broadcast:!1}),i=P.Psbt.fromHex(u.hex);if(n&&w.forEach(a=>{try{i.finalizeInput(a)}catch(A){throw console.error("Sign psbt error",A),new e.OrditSDKError("Failed to finalize input")}}),o)try{return{base64:null,hex:i.extractTransaction().toHex()}}catch(a){throw a instanceof Error&&a.message==="Not finalized"?new e.BrowserWalletExtractTxFromNonFinalizedPsbtError:new e.OrditSDKError("Failed to extract transaction from PSBT")}return{base64:i.toBase64(),hex:i.toHex()}}exports.LeatherAddressType=l;exports.LeatherSignatureHash=N;exports.getAddresses=m;exports.isInstalled=c;exports.signMessage=p;exports.signPsbt=O;
